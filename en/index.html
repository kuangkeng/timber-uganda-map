<!DOCTYPE html>
<html lang="en" dir="ltr">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/leaflet/1.7.1/leaflet.css"/>
    <script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/leaflet/1.7.1/leaflet.js"></script>
    <script src='https://api.mapbox.com/mapbox.js/v3.3.1/mapbox.js'></script>
    <link href='https://api.mapbox.com/mapbox.js/v3.3.1/mapbox.css' rel='stylesheet' />
    <script src="https://cdnjs.cloudflare.com/ajax/libs/waypoints/4.0.1/noframework.waypoints.js"></script>
	  <script type="text/javascript" src="../js/tropical-map-10.js"></script>
	  <script type="text/javascript" src="../js/indonesia-malaysia.js"></script>
	  <script type="text/javascript" src="../js/congo-maps-en.js"></script>
  </head>

<style>
body {
  font: normal 12px/20px 'Open Sans','Helvetica Neue',Helvetica,Verdana,Arial,sans-serif;
  color: black;
  box-sizing: border-box;
  margin: 0;
} 
#wrapper {
  width: 100%;
  max-width: 800px;
  position: relative;
  margin: 0 auto;
  height: 500px;
}
.scroll-logo {
  position:fixed;
  top:200px;
  left:50%;
  width:80px;
  height:80px;
  margin-left: -40px;
  z-index: 9999;
  padding:5px;
}
.scroll-path{
  stroke-width: 10;
  stroke: #515151;
}
@keyframes blink2 {
  100%,
  0% {opacity:0.2;}
  60% {opacity:1;}
}
.flash2 {
  animation: blink2 1.2s infinite;
}
.mapbox { 
  height: 500px; 
  width: 100%;
  max-width: 800px;
  margin: 0px;
  position: fixed;
  top:0px;
  margin: auto 0px;
  z-index: 0 !important;
}
.leaflet-bottom {
	bottom: 1rem;
}
.leaflet-right {
	right: 1rem;
}
.leaflet-tooltip-top:before, 
.leaflet-tooltip-bottom:before, 
.leaflet-tooltip-left:before, 
.leaflet-tooltip-right:before {
    border: none !important;
}
.leaflet-tooltip{
  font-size: 13px;
  font-weight: 600;
  line-height: 13px;
  text-align: center;
	color: #3f3f3f;
  text-shadow: 1px 1px 1px rgba(255,255,255,0.2);
  background-color: rgba(0,0,0,0) !important;
  border:none !important;
  box-shadow: none !important;
}
.leaflet-tooltip-pane {
  z-index: 666;
}
.container {
  padding-left: 40px;
  padding-right: 40px;
}
#map-texts {
  position: relative;
  z-index: 999;
}
.scroll-text{
  border: 1px solid #ddd;
  padding: 15px;
  border-radius: 5px;
  background: rgba(255,255,255,.8);
  margin-bottom: 500px !important;
}
.scroll-text p {
  font-size: 20px;
  line-height: 160%;
  color: #333;
  margin: 0px;
}
#t8{
  margin-bottom: 800px !important;
}
#tfirst, #tlast {
  border: 0px;
  background: rgba(255,255,255,0);
}
ul {
  list-style: none;
  padding: 0;
}
.idmy {
  color:#e41a1c;
  font-weight: 600;
}
.congo {
  color:#026440;
  font-weight: 600;
}
.countries {
  color:#ff7f00;
  font-weight: 600;
}
@keyframes blink {
  100%,
  0% {fill: #9f1214;}
  60% {fill: #e41a1c;}
}
.flash {
  animation: blink 1.2s infinite;
}
@media (max-width: 500px){
  .scroll-text {
    padding: 10px;
  }
  .scroll-text p {
    font-size: 14px;
    line-height: 150%;
  }
  .container {
    padding-left: 10px;
    padding-right: 10px;
  }
  .leaflet-tooltip{
    font-size: 10px;
    font-weight: 500;
    line-height: 10px;
  }
}

</style>
</head>
<body>

<div id="wrapper"> 
    <div class="scroll-logo flash2">
      <svg version="1.1" viewBox="0 0 700 700" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink">
        <g>
        <path class="scroll-path" d="m459.38 227.5c-8.3125 0.11719-16.215 3.625-21.875 9.7109-0.80078-7.7891-4.582-14.969-10.551-20.035-5.9727-5.0703-13.668-7.6328-21.484-7.1602s-15.148 3.9453-20.465 9.6953c-0.82422-7.5234-4.4141-14.473-10.07-19.504-5.6602-5.0273-12.984-7.7734-20.555-7.707-8.5039 0.019531-16.543 3.8789-21.875 10.5v-98c0-10.941-5.8359-21.051-15.312-26.523-9.4766-5.4688-21.148-5.4688-30.625 0-9.4766 5.4727-15.312 15.582-15.312 26.523v271.25c0 39.074 20.848 75.184 54.688 94.723 33.84 19.535 75.535 19.535 109.38 0 33.84-19.539 54.688-55.648 54.688-94.723v-118.12c0-8.1211-3.2266-15.91-8.9688-21.656-5.7461-5.7422-13.535-8.9688-21.656-8.9688zm21.875 148.75c0 35.949-19.18 69.168-50.312 87.145-31.133 17.973-69.492 17.973-100.62 0-31.133-17.977-50.312-51.195-50.312-87.145v-271.25c0-7.8164 4.168-15.035 10.938-18.945 6.7695-3.9062 15.105-3.9062 21.875 0 6.7695 3.9102 10.938 11.129 10.938 18.945v179.38c0 2.418 1.957 4.375 4.375 4.375s4.375-1.957 4.375-4.375v-52.5c0-18.898 8.75-30.625 21.875-30.625 5.8008 0 11.367 2.3047 15.469 6.4062s6.4062 9.668 6.4062 15.469v70c0 2.418 1.957 4.375 4.375 4.375s4.375-1.957 4.375-4.375v-52.5c0-7.8164 4.168-15.035 10.938-18.945 6.7695-3.9062 15.105-3.9062 21.875 0 6.7695 3.9102 10.938 11.129 10.938 18.945v61.25c0 2.418 1.957 4.375 4.375 4.375s4.375-1.957 4.375-4.375v-43.75c0-7.8164 4.168-15.035 10.938-18.945 6.7695-3.9062 15.105-3.9062 21.875 0 6.7695 3.9102 10.938 11.129 10.938 18.945z"/>
        <path class="scroll-path" d="m249.38 109.64c0.80078 0.83203 1.9062 1.3047 3.0625 1.3125 1.1836-0.003907 2.3164-0.47266 3.1484-1.3125 1.6797-1.7305 1.6797-4.4805 0-6.2109l-22.137-22.137-22.137 22.137c-0.82812 0.82031-1.293 1.9375-1.293 3.1055s0.46484 2.2852 1.293 3.1055c0.79297 0.84766 1.9023 1.3281 3.0625 1.3281s2.2695-0.48047 3.0625-1.3281l11.637-11.551v70.961l-11.637-11.547c-0.79297-0.84766-1.9023-1.3242-3.0625-1.3242s-2.2695 0.47656-3.0625 1.3242c-0.82812 0.82031-1.293 1.9414-1.293 3.1055 0 1.168 0.46484 2.2852 1.293 3.1055l22.137 22.137 3.0625-3.1484 19.074-18.988c1.6797-1.7305 1.6797-4.4805 0-6.2109-0.82031-0.82812-1.9375-1.293-3.1055-1.293-1.1641 0-2.2852 0.46484-3.1055 1.293l-11.551 11.551v-70.965z"/>
        </g>
      </svg>       
    </div>
    <div class="mapbox" id="map-container" ></div>
    <div id="map-texts">
      <div class="container">
        <ul>
          <li id="tfirst" class="scroll-text"></li>
          <li id="t1" class="scroll-text">
            <p>Oil palm is a tropical plant species. Its best growing areas are along a <span class="congo">narrow band</span> just above and below the equator. Tropical rainforests, which are home to the world's highest biodiversity, are also found in the same areas.</p>
          </li>
          <li id="t2" class="scroll-text">
            <p>The rapid spread of palm oil plantations have replaced massive tracts of rainforests in Southeast Asia. <span class="idmy">Indonesia</span> and <span class="idmy">Malaysia</span> are the largest producers of palm oil accounting for nearly 85% of global production.</p>
          </li>
          <li id="t3" class="scroll-text">
            <p>As agricultural land becomes increasingly scarce in Southeast Asia, and regulatory pressures continue to intensify, the <span class="congo">Congo Basin</span> could become the next frontier for oil palm expansion. </p>
          </li>
          <li id="t4" class="scroll-text">
            <p>At 314 million hectares, the <span class="congo">Congo Basin</span> is the world's second-largest tropical forest after the Amazon.</p>
          </li>
          <li id="t5" class="scroll-text">
            <p>It spans across  <span class="countries">6 central African countries</span>.</p>
          </li>
          <li id="t6" class="scroll-text">
            <p>There are roughly 280 million hectares of additional land suitable for oil palm in the <span class="congo">Congo Basin</span>. Most of them are found in the <span style="font-weight: 600;">Democratic Republic of Congo</span>, <span style="font-weight: 600;">Cameroon</span> and the <span style="font-weight: 600;">Republic of Congo</span>.</p>
          </li>
          <li id="t7" class="scroll-text">
            <p>If we put them in a <span class="idmy">box</span>, it would cover most of the <span style="font-weight: 600;">Democratic Republic of Congo</span>.</p>
          </li>
          <li id="t8" class="scroll-text">
            <p>60% of those lands that could be cleared for palm oil plantations are located in the <span style="font-weight: 600;">Democratic Republic of Congo</span>, the focus of this investigation.</p>
          </li>
          <li id="tlast" class="scroll-text"></li>
        </ul> 
      </div> 
    </div> 
</div>  

<script type="text/javascript">
var zoomlevel;
if(window.innerWidth>500){
  zoomlevel = 2.2;
} else if(window.innerWidth<500){
  zoomlevel = 1;
}
L.mapbox.accessToken = 'pk.eyJ1Ijoia3VhbmdrZW5nIiwiYSI6ImNrd3A1cnNsNTA5cGMyd3FvYWJxZWk5bnUifQ.8LExDPdXiAr4khBDLmIjEA';

var mymap = L.map('map-container',{
  zoomControl:false, 
  scrollWheelZoom:false, 
  dragging:false, 
  zoomSnap:0.1,
  doubleClickZoom: false,
  maxZoom:6,
  minZoom:0.1,
}).setView([-1.529, 23.997], zoomlevel);

var bound_initial = mymap.getBounds();

L.tileLayer(
    'https://api.mapbox.com/styles/v1/kuangkeng/ckwp5ycyw4sr214o5rl6u4svt/tiles/256/{z}/{x}/{y}@2x?access_token=' + L.mapbox.accessToken, {
        tileSize: 512,
        zoomOffset: -1,
        attribution: '© <a href="https://www.mapbox.com/contribute/">Mapbox</a> © <a href="http://www.openstreetmap.org/copyright">OpenStreetMap</a>'
    }).addTo(mymap);

function style_tropical(feature) {
    return {
        fillColor: '#026440',
        weight: 0.5,
        opacity: 0,
        color: '#d3d3d3',
        fillOpacity: 0
    };
}

function style_idmy(feature) {
    return {
        fillColor: '#e41a1c',
        weight: 0.5,
        opacity: 1,
        color: '#d3d3d3',
        fillOpacity: 1
    };
}

function style_congo(feature) {
    return {
        fillColor: '#026440',
        weight: 0.5,
        opacity: 1,
        color: '#d3d3d3',
        fillOpacity: 0.8
    };
}

function style_countries(feature) {
    return {
        fillColor: '#026440',
        weight: 1,
        opacity: 0.7,
        color: '#ff7f00',
        fillOpacity: 0
    };
}

function style_square1(feature) {
    return {
        fillColor: '#e41a1c',
        weight: 5,
        opacity: 0,
        color: '#e41a1c',
        fillOpacity: 0
    };
}

function style_square2(feature) {
    return {
        fillColor: '#e41a1c',
        weight: 5,
        opacity: 0,
        color: '#e41a1c',
        fillOpacity: 0
    };
}

//create pane to fix the zindex
mymap.createPane('pane_tropical');
mymap.createPane('pane_idmy');
mymap.createPane('pane_congo');
mymap.createPane('pane_square1');
mymap.createPane('pane_square2');
mymap.createPane('pane_countries');

//Set up layers
var layer_tropical = L.geoJSON(tropical_map, {
    style: style_tropical,
    pane: 'pane_tropical'
});

var layer_idmy = L.geoJSON(idmy_map, {
    style: style_idmy,
    pane: 'pane_idmy'
});

var layer_congo = L.geoJSON(congo_map, {
    style: style_congo,
    pane: 'pane_congo'
});

const determineTooltipDirection = country => {
    if (country === 'Dem. Rep.<br>of Congo') return 'top'
    return 'center'
}
const determineTooltipOffset = country => {
  if (country === 'Cameroon') return [8,-5]  
  if (country === 'Republic<br>of Congo') return [-14,15]
  if (country === 'Equatorial<br>Guinea') return [15,0]
  return [0,0]
}

var layer_countries = L.geoJSON(countries, {
    style: style_countries,
    pane: 'pane_countries',
    onEachFeature: (feature, layer) => {
      layer.bindTooltip(feature.properties['nom_pays'], {
        permanent: true,
        direction: determineTooltipDirection(
          feature.properties['nom_pays']
        ),
        offset: determineTooltipOffset(
          feature.properties['nom_pays']
        ),
        interactive: true,
  })
    }
});

var layer_square1 = L.geoJSON(square_1, {
    style: style_square1,
    pane: 'pane_square1'
});

var layer_square2 = L.geoJSON(square_2, {
    style: style_square2,
    pane: 'pane_square2'
});

const congoMarker1 = L.marker([11.39,10.46]),
	congoMarker2 = L.marker([11.39,35.42]),
	congoMarker3 = L.marker([-11.11,10.46]),
	congoMarker4 = L.marker([-11.11,35.42]);

const flyTime = 2;

const congoMarkers = new L.featureGroup([
	congoMarker1,
	congoMarker2,
	congoMarker3,
	congoMarker4,
]);

//waypoint transition
const offsetVal = '80%';

mymap.addLayer(layer_tropical);
mymap.addLayer(layer_square1);
mymap.addLayer(layer_square2);
new Waypoint({
  element: document.getElementById('t1'),
  handler: direction => {
    if (direction === 'down') {
      fadeInLayer(layer_tropical, 0, 0.8, 0.02, 30)
      $('.scroll-logo').hide();
    } else {
      fadeOutLayer(layer_tropical, 0.8, 0, 0.02, 30);
      
    }
  },
  offset: offsetVal,
});

new Waypoint({
  element: document.getElementById('t2'),
  handler: direction => {
    if (direction === 'down') {
	    mymap.addLayer(layer_idmy);
      $('.leaflet-pane_idmy-pane path').addClass('flash');
    } else {
      mymap.removeLayer(layer_idmy);
      $('.leaflet-pane_idmy-pane path').removeClass('flash');
    }
  },
  offset: offsetVal,
});

new Waypoint({
  element: document.getElementById('t3'),
  handler: direction => {
    if (direction === 'down') {
      mymap.addLayer(layer_congo);
      fadeOutLayer(layer_tropical, 0.8, 0.4, 0.02, 30);
    } else {
      fadeInLayer(layer_tropical, 0.4, 0.8, 0.02, 30)
      mymap.removeLayer(layer_congo);
    }
  },
  offset: offsetVal,
});

new Waypoint({
  element: document.getElementById('t4'),
  handler: direction => {
    if (direction === 'down') {
        mymap.removeLayer(layer_tropical);
        fadeOutLayer(layer_tropical, 0.4, 0, 0.02, 30)
      congoMarkers.addTo(mymap);
      congoMarkers.eachLayer(function(layer) {
            layer.setOpacity(0);
          });
      mymap.flyToBounds(congoMarkers.getBounds(), {
          padding: [50, 50],
          duration: flyTime
        });
    } else {
        mymap.addLayer(layer_tropical);
      fadeInLayer(layer_tropical, 0, 0.4, 0.02, 30)
      mymap.flyToBounds(bound_initial, {
        duration: flyTime
      });
    }
  },
  offset: offsetVal,
});

new Waypoint({
  element: document.getElementById('t5'),
  handler: direction => {
    if (direction === 'down') {
      mymap.addLayer(layer_countries);
      fadeOutLayer(layer_congo, 0.8, 0.4, 0.02, 30)
    } else {
      fadeInLayer(layer_congo, 0.4, 0.8, 0.02, 30)
      mymap.removeLayer(layer_countries);
    }
  },
  offset: offsetVal,
});

new Waypoint({
  element: document.getElementById('t6'),
  handler: direction => {
    if (direction === 'down') {
      layer_countries.eachLayer(function (layer) {  
        if(layer.feature.properties['nom_pays'] == 'Equatorial<br>Guinea' || 
        layer.feature.properties['nom_pays'] == 'Central African<br>Republic' || 
        layer.feature.properties['nom_pays'] == 'Gabon') {    
          layer.setStyle({weight :0});
          layer.closeTooltip(); 
        }
      });      
    } else {
      layer_countries.eachLayer(function (layer) {  
        if(layer.feature.properties['nom_pays'] == 'Equatorial<br>Guinea' || 
        layer.feature.properties['nom_pays'] == 'Central African<br>Republic' || 
        layer.feature.properties['nom_pays'] == 'Gabon') {   
          layer.setStyle({weight :1});
          layer.openTooltip(); 
        }
      }); 
    }
  },
  offset: offsetVal,
});

new Waypoint({
  element: document.getElementById('t7'),
  handler: direction => {
    if (direction === 'down') {
      fadeInBorder(layer_square1, 0, 1, 0.02, 30)
      layer_countries.eachLayer(function (layer) {  
        if(layer.feature.properties['nom_pays'] == 'Dem. Rep.<br>of Congo') {    
          layer.setStyle({weight :3, opacity:1});
        }
        if(layer.feature.properties['nom_pays'] == 'Cameroon' ||
          layer.feature.properties['nom_pays'] == 'Republic<br>of Congo') {    
          layer.setStyle({weight :0, fillOpacity:0});
          layer.closeTooltip(); 
        }
      }); 
    } else {
      fadeOutBorder(layer_square1, 1, 0, 0.02, 10)
      layer_countries.eachLayer(function (layer) {  
        if(layer.feature.properties['nom_pays'] == 'Dem. Rep.<br>of Congo') {    
          layer.setStyle({weight :1, opacity:0.7});
        }
        if(layer.feature.properties['nom_pays'] == 'Cameroon' ||
          layer.feature.properties['nom_pays'] == 'Republic<br>of Congo') {    
          layer.setStyle({weight :1, fillOpacity:0});
          layer.openTooltip(); 
        }
      });
    }
  },
  offset: offsetVal,
});

new Waypoint({
  element: document.getElementById('t8'),
  handler: direction => {
    if (direction === 'down') {
      fadeOutBorder(layer_square1, 1, 0, 0.02, 10)
      fadeInBorder(layer_square2, 0, 1, 0.02, 10)
      mymap.removeLayer(layer_square1);
    } else {
      fadeInBorder(layer_square1, 0, 1, 0.02, 10)
      fadeOutBorder(layer_square2, 1, 0, 0.02, 10)
      mymap.addLayer(layer_square1);
    }
  },
  offset: offsetVal,
});


mymap.getPane('pane_square2').style.zIndex = 250;
mymap.getPane('pane_square1').style.zIndex = 240;
mymap.getPane('pane_congo').style.zIndex = 230;
mymap.getPane('pane_countries').style.zIndex = 220;
mymap.getPane('pane_idmy').style.zIndex = 210;
mymap.getPane('pane_tropical').style.zIndex = 200;

// Fade-in/out effects for layers
function fadeInLayer(lyr, startOpacity, finalOpacity, opacityStep, delay) {
  let opacity = startOpacity;
  let timer = setTimeout(function changeOpacity() {
    if (opacity < finalOpacity) {
      lyr.setStyle({
        opacity: opacity,
        fillOpacity: opacity
      });
      opacity = opacity + opacityStep
    }
    timer = setTimeout(changeOpacity, delay);
  }, delay)
}

function fadeOutLayer(lyr, startOpacity, finalOpacity, opacityStep, delay) {
  let opacity = startOpacity;
  let timer = setTimeout(function changeOpacity() {
    if (finalOpacity < opacity) {
      opacity = opacity - opacityStep
      lyr.setStyle({
        opacity: opacity,
        fillOpacity: opacity
      });
    }
    timer = setTimeout(changeOpacity, delay);
  }, delay)
}

function fadeInBorder(lyr, startOpacity, finalOpacity, opacityStep, delay) {
  let opacity = startOpacity;
  let timer = setTimeout(function changeOpacity() {
    if (opacity < finalOpacity) {
      lyr.setStyle({
        opacity: opacity,
        // fillOpacity: opacity
      });
      opacity = opacity + opacityStep
    }
    timer = setTimeout(changeOpacity, delay);
  }, delay)
}

function fadeOutBorder(lyr, startOpacity, finalOpacity, opacityStep, delay) {
  let opacity = startOpacity;
  let timer = setTimeout(function changeOpacity() {
    if (finalOpacity < opacity) {
      opacity = opacity - opacityStep;
      lyr.setStyle({
        opacity: opacity,
      });
      
    }
    timer = setTimeout(changeOpacity, delay);
  }, delay)
}

</script>
</body>
</html>